// –õ–æ–∫–∞–ª—å–Ω—ñ ¬´AI¬ª –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π ‚Äî —Ç—ñ–ª—å–∫–∏ —â–æ–± –±–æ—Ç –∑–∞–≤–∂–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤.

export async function aiText(input, env) {
  const q = (input || "").trim();
  if (!q) return "–Ø –æ—Ç—Ä–∏–º–∞–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π –∑–∞–ø–∏—Ç. –ù–∞–ø–∏—à–∏ –±—É–¥—å-—è–∫–µ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –¥—É–º–∫—É üôÇ";

  // –î—É–∂–µ –∫–æ—Ä–æ—Ç–∫–∞ ¬´–º–æ–¥–µ–ª—å¬ª: –≤–∏–∑–Ω–∞—á–∞—î –Ω–∞–º—ñ—Ä —ñ –¥–∞—î –ª–∞–∫–æ–Ω—ñ—á–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å
  const lower = q.toLowerCase();
  if (lower.includes("–∫—É—Ä—Å –¥–æ–ª–∞—Ä") || lower.includes("–∫—É—Ä—Å –¥–æ–ª–∞—Ä–∞")) {
    return "–Ø –Ω–µ –º–∞—é –æ–Ω–ª–∞–π–Ω–æ–≤–∏—Ö –∫–æ—Ç–∏—Ä—É–≤–∞–Ω—å —Ç—É—Ç, –∞–ª–µ –º–æ–∂—É –ø—ñ–¥–∫–∞–∑–∞—Ç–∏ –¥–µ –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è: Monobank/–ù–ë–£/–±–∞–Ω–∫–∏. –ê–±–æ —Å–∫–∞–∂–∏ –º—ñ—Å—Ç–æ/–±–∞–Ω–∫ ‚Äî –ø—ñ–¥–∫–∞–∂—É, —è–∫ –∑–Ω–∞–π—Ç–∏ —à–≤–∏–¥—à–µ.";
  }

  // –ï—Ö–æ-—Å–∞–º–º–∞—Ä—ñ
  if (q.length < 15) {
    return `–ì–æ—Ç–æ–≤–æ! –Ø –æ—Ç—Ä–∏–º–∞–≤ —Ç–≤—ñ–π –∑–∞–ø–∏—Ç —ñ –≤—ñ–¥–ø–æ–≤—ñ–º –ø—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:\n\n‚Ä¢ ${q}`;
  } else {
    const first = q.slice(0, 140);
    return `–ö–æ—Ä–æ—Ç–∫–æ –ø—Ä–æ —Ç–≤–æ—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:\n\n${first}${q.length > 140 ? "..." : ""}`;
  }
}

export async function aiVision({ bytes, mime, caption }, env) {
  // –Ø–∫—â–æ –±–∞–π—Ç—ñ–≤ –Ω–µ–º–∞—î ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î–º–æ –≤–≤—ñ—á–ª–∏–≤–æ
  if (!bytes) {
    return [
      "üìù –ë–∞—á—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è/—Ñ–∞–π–ª (–∞–ª–µ TG –Ω–µ –¥–∞–≤ –ø—Ä—è–º–∏–π URL –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è).",
      caption ? `–¢–≤—ñ–π –ø—ñ–¥–ø–∏—Å: ${caption}` : "",
      "–û–ø–∏—à–∏, —â–æ —Å–∞–º–µ —Ü—ñ–∫–∞–≤–∏—Ç—å –Ω–∞ —Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç—ñ ‚Äî —ñ —è –¥–æ–ø–æ–º–æ–∂—É –≤–∏—Å–Ω–æ–≤–∫–æ–º.",
    ].filter(Boolean).join("\n");
  }

  // –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π ¬´–∞–Ω–∞–ª—ñ–∑–∞—Ç–æ—Ä¬ª: —Ç—ñ–ª—å–∫–∏ –ø—ñ–¥–ø–∏—Å + –±–∞–∑–æ–≤–∞ –¥–æ–≤—ñ–¥–∫–∞
  const kb = Math.round(bytes.byteLength / 1024);
  const hint = caption
    ? `–¢–≤—ñ–π –ø—ñ–¥–ø–∏—Å: ${caption}\n`
    : "";

  return `${hint}–ó–∞–≤–∞–Ω—Ç–∞–∂–∏–≤ —Ñ–∞–π–ª ~${kb} –ö–ë (${mime || "unknown"}). –°–∫–∞–∂–∏, —â–æ —Å–∞–º–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ: –≤–∏–ø–∏—Å–∞—Ç–∏ —Ç–µ–∫—Å—Ç, –∑–Ω–∞–π—Ç–∏ —á–∏—Å–ª–∞/–¥–∞—Ç–∏, –∑—Ä–æ–±–∏—Ç–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ —Ç–æ—â–æ.`;
}