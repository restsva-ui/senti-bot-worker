// src/flows/visionPolicy.js
// –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–ª—è vision-–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π Senti –∑ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é –∫—ñ–ª—å–∫–æ—Ö –º–æ–≤ + –≤–∏—è–≤–ª–µ–Ω–Ω—è –º—ñ—Å—Ü—è.

const BASE_RULES = `
–ü—Ä–∞–≤–∏–ª–∞ –í–ê–ñ–õ–ò–í–û:
- –ü–∏—à–∏ –ª–∞–∫–æ–Ω—ñ—á–Ω–æ: 1‚Äì2 —Ä–µ—á–µ–Ω–Ω—è –æ–ø–∏—Å—É + (–∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ) –∫–æ—Ä–æ—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç—ñ–≤.
- –°–ø–æ—á–∞—Ç–∫—É –í–ò–¢–Ø–ì–ù–ò —Ç–µ–∫—Å—Ç —ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (OCR) —ñ –ø—Ä–æ—Ü–∏—Ç—É–π –π–æ–≥–æ –¥–æ—Å–ª—ñ–≤–Ω–æ.
- –ë—Ä–µ–Ω–¥–∏/–º–æ–¥–µ–ª—ñ –Ω–∞–∑–∏–≤–∞–π –ª–∏—à–µ —è–∫—â–æ –≤–∏–¥–Ω–æ –ª–æ–≥–æ—Ç–∏–ø –∞–±–æ –Ω–∞–∑–≤—É; —ñ–Ω–∞–∫—à–µ ‚Äî "–ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π".
- –Ø–∫—â–æ –±—Ä–µ–Ω–¥ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è (–ª–æ–≥–æ—Ç–∏–ø/–º–∞—Ä–∫—É–≤–∞–Ω–Ω—è —á—ñ—Ç–∫–æ –≤–∏–¥–Ω–æ) ‚Äî –¥–æ–∑–≤–æ–ª–µ–Ω–æ: "—Å—Ö–æ–∂–µ –Ω–∞ ¬´...¬ª, ~–ô–ú–û–í–Ü–†–ù–Ü–°–¢–¨‚âà–•%".
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—Å—Ç–∞–≤–∏–≤ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–∞–º–µ –Ω–∞ –Ω—å–æ–≥–æ. –Ø–∫—â–æ –¥–∞–Ω–∏—Ö –±—Ä–∞–∫—É—î ‚Äî ‚Äú–ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π‚Äù.
- –ù–µ –≤–∏–≥–∞–¥—É–π —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —á–∏ –¥–∂–µ—Ä–µ–ª–∞.

–î–û–î–ê–¢–ö–û–í–û (–º—ñ—Å—Ü—è/–æ—Ä—ñ—î–Ω—Ç–∏—Ä–∏):
- –Ø–∫—â–æ –≤–ø—ñ–∑–Ω–∞–≤ –º—ñ—Å—Ç–æ/–º—ñ—Å—Ü–µ/–æ—Ä—ñ—î–Ω—Ç–∏—Ä, –¥–æ–¥–∞–π –æ–∫—Ä–µ–º–∏–π —Ä—è–¥–æ–∫ —Ñ–æ—Ä–º–∞—Ç—É: PLACE=<–∫–æ—Ä–æ—Ç–∫–∞ –Ω–∞–∑–≤–∞ (—É–∫—Ä/–º–æ–≤–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ)>
- –Ø–∫—â–æ –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π ‚Äî –Ω–µ –¥–æ–¥–∞–≤–∞–π —Ä—è–¥–æ–∫ PLACE.
- –ù–µ –≤–∏–≥–∞–¥—É–π PLACE –±–µ–∑ –æ–∑–Ω–∞–∫ (–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, –≤–∏–≤—ñ—Å–∫–∏, –ø–µ–π–∑–∞–∂, –Ω–∞–ø–∏—Å–∏ —Ç–æ—â–æ).

–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç:
üñºÔ∏è –ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å (1‚Äì2 —Ä–µ—á–µ–Ω–Ω—è).
üìù –¢–µ–∫—Å—Ç –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: "..." (—è–∫—â–æ –Ω–µ–º–∞—î ‚Äî –Ω–∞–ø–∏—à–∏ "–Ω–µ–º–∞—î" –∞–±–æ "–Ω–µ—á–∏—Ç–∫–æ").
‚ùì–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (—è–∫—â–æ –±—É–ª–æ).
(–û–ø—Ü—ñ–π–Ω–æ) üìç–ú—ñ—Å—Ü–µ/–æ—Ä—ñ—î–Ω—Ç–∏—Ä: ...
(–û–ø—Ü—ñ–π–Ω–æ) PLACE=...
`.trim();

const HINTS = {
  uk: `–¢–∏ ‚Äî Senti, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.\n${BASE_RULES}`,
  en: `You are Senti, reply in concise English.\n${BASE_RULES}`,
  de: `Du bist Senti und beschreibst Bilder auf Deutsch.\n${BASE_RULES}`,
  fr: `Tu es Senti et tu r√©ponds en fran√ßais.\n${BASE_RULES}`,
  ru: `–¢—ã ‚Äî Senti, –æ—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ –Ω–∞ —Ä—É—Å—Å–∫–æ–º.\n${BASE_RULES}`
};

export function buildVisionHintByLang(langCode) {
  const lc = String(langCode || "").toLowerCase();
  return HINTS[lc] || HINTS.uk;
}
export function makeVisionUserPrompt(userText = "") {
  const t = String(userText || "").trim();
  if (!t) return "–û–ø–∏—à–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è. –Ø–∫—â–æ –≤–ø—ñ–∑–Ω–∞–≤ –º—ñ—Å—Ü–µ ‚Äî –¥–æ–¥–∞–π —Ä—è–¥–æ–∫ PLACE=...";
  return `${t}\n\n–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è: —è–∫—â–æ –≤–ø—ñ–∑–Ω–∞–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ –º—ñ—Å—Ü–µ/–æ—Ä—ñ—î–Ω—Ç–∏—Ä ‚Äî –¥–æ–¥–∞–π —Ä—è–¥–æ–∫ PLACE=...`;
}