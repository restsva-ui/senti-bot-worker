// src/flows/visionPolicy.js
// –ü–æ–ª—ñ—Ç–∏–∫–∞ –¥–ª—è vision-–≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π Senti: —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞, —Å–ø–µ—Ä—à—É OCR,
// –±–µ–∑ –≤–∏–≥–∞–¥—É–≤–∞–Ω—å (–±—Ä–µ–Ω–¥–∏/–º–æ–¥–µ–ª—ñ –ª–∏—à–µ –∑–∞ —è–≤–Ω–∏–º–∏ –æ–∑–Ω–∞–∫–∞–º–∏).

export const visionSystemHintUk = `
–¢–∏ ‚Äî Senti, –∞—Å–∏—Å—Ç–µ–Ω—Ç —â–æ –æ–ø–∏—Å—É—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.
–ü—Ä–∞–≤–∏–ª–∞ –í–ê–ñ–õ–ò–í–û:
- –ü–∏—à–∏ –ª–∞–∫–æ–Ω—ñ—á–Ω–æ: 1‚Äì2 —Ä–µ—á–µ–Ω–Ω—è –æ–ø–∏—Å—É + (–∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ) —Å–ø–∏—Å–æ–∫ —Ñ–∞–∫—Ç—ñ–≤.
- –°–ø–æ—á–∞—Ç–∫—É –í–ò–¢–Ø–ì–ù–ò —Ç–µ–∫—Å—Ç —ñ–∑ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è (OCR) —ñ –ø—Ä–æ—Ü–∏—Ç—É–π –π–æ–≥–æ –¥–æ—Å–ª—ñ–≤–Ω–æ.
- –ë—Ä–µ–Ω–¥–∏/–º–æ–¥–µ–ª—ñ –Ω–∞–∑–∏–≤–∞–π –ª–∏—à–µ —è–∫—â–æ –≤–∏–¥–Ω–æ –ª–æ–≥–æ—Ç–∏–ø –∞–±–æ –Ω–∞–∑–≤—É; —ñ–Ω–∞–∫—à–µ ‚Äî "–ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π".
- –Ø–∫—â–æ –±—Ä–µ–Ω–¥ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î—Ç—å—Å—è (–ª–æ–≥–æ—Ç–∏–ø/–º–∞—Ä–∫—É–≤–∞–Ω–Ω—è —á—ñ—Ç–∫–æ –≤–∏–¥–Ω–æ) ‚Äî –¥–æ–∑–≤–æ–ª–µ–Ω–æ: "—Å—Ö–æ–∂–µ –Ω–∞ ¬´...¬ª, ~–ô–ú–û–í–Ü–†–ù–Ü–°–¢–¨‚âà–•%".
- –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—Å—Ç–∞–≤–∏–≤ –ø–∏—Ç–∞–Ω–Ω—è ‚Äî –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π —Å–∞–º–µ –Ω–∞ –Ω—å–æ–≥–æ. –Ø–∫—â–æ –¥–∞–Ω–∏—Ö –±—Ä–∞–∫—É—î ‚Äî ‚Äú–ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π‚Äù.
- –£–Ω–∏–∫–∞–π –∞–Ω–≥–ª—ñ—Ü–∏–∑–º—ñ–≤ –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏. –í—ñ–¥–ø–æ–≤—ñ–¥—å ‚Äî —Ç—ñ–ª—å–∫–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é.
- –ù–µ –≤–∏–≥–∞–¥—É–π —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —á–∏ –¥–∂–µ—Ä–µ–ª–∞.
–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
üñºÔ∏è –ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å (1‚Äì2 —Ä–µ—á–µ–Ω–Ω—è).
üìù –¢–µ–∫—Å—Ç –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: "..." (—è–∫—â–æ –Ω–µ–º–∞—î ‚Äî –Ω–∞–ø–∏—à–∏ "–Ω–µ–º–∞—î" –∞–±–æ "–Ω–µ—á–∏—Ç–∫–æ").
‚ùì–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (—è–∫—â–æ –±—É–ª–æ –ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞).
‚ö†Ô∏è –ü—Ä–∏–º—ñ—Ç–∫–∞ –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏).
`.trim();

export function makeVisionUserPrompt(question) {
  const q = String(question || "").trim();
  if (!q) {
    return [
      "–û–ø–∏—à–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑–∞ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ç–∞ —Ñ–æ—Ä–º–∞—Ç–æ–º –≤–∏—â–µ.",
      "–Ø–∫—â–æ —î —Ç–µ–∫—Å—Ç –Ω–∞ –∫–∞—Ä—Ç–∏–Ω—Ü—ñ ‚Äî –ø—Ä–æ—Ü–∏—Ç—É–π –¥–æ—Å–ª—ñ–≤–Ω–æ –≤ –ª–∞–ø–∫–∞—Ö.",
      "–ë—Ä–µ–Ω–¥–∏/–º–æ–¥–µ–ª—ñ ‚Äî –ª–∏—à–µ –∑–∞ —è–≤–Ω–∏–º–∏ –æ–∑–Ω–∞–∫–∞–º–∏."
    ].join(" ");
  }
  return [
    `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–∏—Ç–∞—î: "${q}"`,
    "–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –∑–∞ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ç–∞ —Ñ–æ—Ä–º–∞—Ç–æ–º –≤–∏—â–µ.",
    "–Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–º–æ–∂–ª–∏–≤–∞ —á–µ—Ä–µ–∑ –±—Ä–∞–∫ –¥–∞–Ω–∏—Ö ‚Äî —Å–∫–∞–∂–∏: –ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π."
  ].join(" ");
}

export function postprocessVisionText(text) {
  let t = String(text || "").trim();
  t = t.replace(/\r/g, "").replace(/[ \t]+\n/g, "\n").replace(/\n{3,}/g, "\n\n");
  t = t.replace(/–¢–µ–∫—Å—Ç –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ:\s*["‚Äú](.+?)["‚Äù]/g, (m, p1) => `–¢–µ–∫—Å—Ç –Ω–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—ñ: "${p1}"`);
  return t;
}
