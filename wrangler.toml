name = "senti-bot-worker"
main = "src/index.js"
compatibility_date = "2024-09-25"
account_id = "2cf6e316af8623546c95c0354bc3aa00"

# --- CRONs ---
# 1) heartbeat кожні 15 хв (для логів/живості)
# 2) evolve щогодини рівно о :00 (UTC)
# 3) додатковий тригер нічного агента о 02:10 UTC (опційний)
[triggers]
crons = ["*/15 * * * *", "0 * * * *", "10 2 * * *"]

# --- Публічні змінні середовища (НЕ секрети) ---
[vars]
SERVICE_HOST = "senti-bot-worker.restsva.workers.dev"
DRIVE_FOLDER_ID = "root"
TELEGRAM_ADMIN_ID = "784869835"
DEPLOY_ID = "local-dev"

# Увімкнення/вимкнення Learn
LEARN_ENABLED = "on"

# Cloudflare Vision (для @cf/... моделей). ID публічний, токен — у секретах.
CF_ACCOUNT_ID = "2cf6e316af8623546c95c0354bc3aa00"

# ── Доступ до адмін-HTML без секрету (як було "раніше")
# "on" -> дозволяє readonly-перегляд без ?s=
# (також у коді є ?public=1 як форсований readonly)
ALLOW_PUBLIC_REPO = "on"
ALLOW_PUBLIC_STATUT = "on"
ALLOW_PUBLIC_CHECKLIST = "on"

# Секрети для наших HTTP-ендпойнтів і вебхука TG
# Якщо хочеш відкрити все "як раніше", можеш тимчасово прибрати ці значення,
# або залишити їх — і ввімкнути ALLOW_PUBLIC_* як вище.
WEBHOOK_SECRET    = "senti1984"     # використовується у /admin/*, /cron/*
TG_WEBHOOK_SECRET = "senti1984"     # використовується у /tg/webhook (Telegram secret token)

# Локальна таймзона для UI/логів/дебагу часу
TIMEZONE = "Europe/Kyiv"

# ДІАГНОСТИЧНІ ТЕГИ: "on" — показує [via ...], "off" — ховає
DIAG_TAGS = "on"

# --- Порядок fallback-моделей (runtime дефолт) ---
MODEL_ORDER = "gemini:gemini-2.5-flash, cf:@cf/meta/llama-3.1-8b-instruct, openrouter:deepseek/deepseek-chat, free:meta-llama/llama-4-scout:free"

# --- Окремі порядки для тексту/коду (зберігаються у vars) ---
# Текст: якщо є GEMINI_API_KEY — Gemini буде першим; далі CF; потім валідний free-фолбек.
MODEL_ORDER_TEXT = "gemini:gemini-2.5-flash, cf:@cf/meta/llama-3.1-8b-instruct, free:meta-llama/llama-4-scout:free"
# Код: безкоштовний OpenRouter qwen3-coder, потім CF, потім валідний free-фолбек.
MODEL_ORDER_CODE = "openrouter:qwen/qwen3-coder:free, cf:@cf/meta/llama-3.1-8b-instruct, free:meta-llama/llama-4-scout:free"

# --- Дефолтні моделі (необов'язково) ---
GEMINI_MODEL = "gemini-2.5-flash"
CF_MODEL     = "@cf/meta/llama-3.1-8b-instruct"

# --- OpenAI-compatible fallback (через OpenRouter) ---
# ВАЖЛИВО: сам ключ додай як secret:
#   wrangler secret put FREE_API_KEY
FREE_API_BASE_URL = "https://openrouter.ai/api"
FREE_API_MODEL    = "meta-llama/llama-4-scout:free"
FREE_API_PATH     = "/v1/chat/completions"

# --- Керування нічними авто-поліпшеннями ---
AUTO_IMPROVE     = "on"   # "off" щоб вимкнути
# Основний добовий запуск агента відбувається на годинному кроні ("0 * * * *"),
# коли getUTCHours() === NIGHTLY_UTC_HOUR. 23 UTC ~= 02:00 за Києвом.
NIGHTLY_UTC_HOUR = "23"

# --- Self-Regulation (ввімк/вимк та сила тюнінгу) ---
SELF_REGULATE       = "on"
SELF_TUNING_FACTOR  = "0.3"

# --- ⚡ ЕНЕРГІЯ (щоб не зникали на деплої) ---
ENERGY_MAX = "100"
ENERGY_RECOVER_PER_MIN = "1"
ENERGY_COST_TEXT = "1"
ENERGY_COST_IMAGE = "5"
ENERGY_LOW_THRESHOLD = "10"

# --- KV bindings ---
[[kv_namespaces]]
binding = "DEDUP_KV"
id = "20d81d7b68fa4ac6b9913e2fbd3465d5"

[[kv_namespaces]]
binding = "OAUTH_KV"
id = "e2a8d3941b4e41728318781e739a4d47"

[[kv_namespaces]]
binding = "STATE_KV"
id = "7b32e2d1f60846ddb1c653eb52180bf7"

[[kv_namespaces]]
binding = "TODO_KV"
id = "497eac980691495ea2a0bc8611892d65"

[[kv_namespaces]]
binding = "USER_OAUTH_KV"
id = "470d4f5c164a4a828c569eb9a52a5133"

[[kv_namespaces]]
binding = "CHECKLIST_KV"
id = "497eac980691495ea2a0bc8611892d65"

# Пам'ять/лайки/нічні імпруви
[[kv_namespaces]]
binding = "LIKES_KV"
id = "f7d480c281ad47d2bdf270fadf4de021"

# ➕ Журнал енергії
[[kv_namespaces]]
binding = "ENERGY_LOG_KV"
id = "9e6f0ed5bf2544a9a63d57455900a844"

# ➕ Діалоги (коротка пам'ять між сесіями)
[[kv_namespaces]]
binding = "DIALOG_KV"
id = "63c0d1e0962a419ca54082893410b28e"

# ➕ Черга навчання (для Learn)
[[kv_namespaces]]
binding = "LEARN_QUEUE_KV"
id = "86a54c59ce674a558780c58bf1a47dfd"

# --- R2 buckets (для upload файлів у Learn) ---
[[r2_buckets]]
binding = "LEARN_BUCKET"           # використовуй у коді: env.LEARN_BUCKET
bucket_name = "senti-learn"
# preview_bucket_name = "senti-learn-preview"  # (необов'язково)

# ───────────────────────── ПІДКАЗКИ ПО СЕКРЕТАХ ─────────────────────────
# Додай ОКРЕМИМИ СЕКРЕТАМИ (не у [vars]):
#   wrangler secret put GEMINI_API_KEY
#   wrangler secret put OPENROUTER_API_KEY
#   wrangler secret put FREE_API_KEY
#   wrangler secret put TELEGRAM_BOT_TOKEN
#   wrangler secret put CLOUDFLARE_API_TOKEN
# Якщо щось з цього відсутнє — відповідні можливості будуть обмежені.
